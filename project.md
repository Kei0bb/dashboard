# 半導体ダッシュボード

## 1. 概要

このプロジェクトは、Streamlitで構築されたファブレス半導体企業向けのWebベースのダッシュボードです。ウェーハの歩留まりやウェーハ受け入れテスト（WAT）の統計的プロセス制御（SPC）データなど、製造データを可視化・分析するための使いやすいインターフェースを提供します。このアプリケーションは、モジュール化され、メンテナンスしやすいように設計されています。

## 2. 主な機能

*   **インタラクティブなダッシュボード**: Streamlitで構築された、シンプルでクリーンなUI。
*   **歩留まり分析**: 選択した製品の歩留まりトレンドを可視化します。
*   **WAT SPC分析**: 主要なWATパラメータの管理図（Iチャート）を、管理限界線（UCL/LCL）や規格限界線（USL/LSL）と共に表示します。
*   **動的な製品選択**: `data`ディレクトリ内のフォルダ構成に基づき、サイドバーから製品を簡単に切り替えることができます。
*   **モジュール化アーキテクチャ**: コードは、データベース操作、UIコンポーネント、チャート作成のための再利用可能なモジュールに整理されています。

## 3. ディレクトリ構成

```
/
├── data/
│   ├── SCP117A/           # 製品ごとのデータフォルダ
│   │   ├── sort.csv
│   │   ├── wat.csv
│   │   └── specs.csv
│   └── SCT101A/
│       ├── sort.csv
│       ├── wat.csv
│       └── specs.csv
├── pages/
│   ├── 1_Yield.py         # 歩留まり分析ページのStreamlitスクリプト
│   └── 2_WAT_SPC.py       # WAT SPC分析ページのStreamlitスクリプト
├── src/
│   └── modules/
│       ├── database.py    # データベース接続とデータ取得を処理
│       ├── sidebar.py     # 製品選択サイドバーの描画
│       └── spc_charts.py  # SPCチャート作成用の関数
├── .python-version        # Pythonのバージョンを指定 (3.13)
├── main.py                # Streamlitアプリケーションのホームページ
├── project.md             # このプロジェクト説明ファイル
├── pyproject.toml         # プロジェクトのメタデータと依存関係
└── uv.lock                # uvのロックファイル
```

## 4. セットアップとインストール

### 4.1. 前提条件

*   Python 3.13
*   `uv` (プロジェクトおよび仮想環境管理用)

### 4.2. インストール手順

1.  **リポジトリをクローン:**
    ```bash
    git clone <repository-url>
    cd dashboard
    ```

2.  **仮想環境の作成と依存関係のインストール:**
    `uv`は自動的に仮想環境を作成し、`pyproject.toml`にリストされているパッケージをインストールします。
    ```bash
    uv sync
    ```

## 5. 実行方法

Streamlitアプリケーションを起動するには、プロジェクトのルートディレクトリから以下のコマンドを実行します。

```bash
streamlit run main.py
```

ウェブブラウザで `http://localhost:8501` にアクセスすると、アプリケーションが表示されます。

## 6. 使い方

### 6.1. ホームページ

メインページには、利用可能な製品の簡単な概要が表示されます。

### 6.2. 歩留まりページ (Yield)

1.  ナビゲーションメニューから **Yield** ページに移動します。
2.  サイドバーで製品を選択します。
3.  ページには、選択した製品の歩留まりデータとトレンドチャートが表示されます。

### 6.3. WAT SPCページ

1.  **WAT SPC** ページに移動します。
2.  サイドバーから製品を選択します。
3.  ページには、生のWATデータと、パラメータ選択のドロップダウンが表示されます。
4.  パラメータを選択すると、ウェーハマップとSPCチャートが表示されます。

## 7. モジュールの概要

*   **`src/modules/database.py`**: (現在は主にテストDB初期化に使用)
    *   `create_test_db_engine()`: SQLiteテストデータベースへの接続エンジンを作成します。
    *   `init_test_db()`: テストデータベースにサンプルデータを投入します。

*   **`src/modules/sidebar.py`**:
    *   `product_selector()`: `data`ディレクトリ内のフォルダ名をスキャンし、製品選択のドロップダウンをサイドバーに描画します。

*   **`src/modules/spc_charts.py`**:
    *   `load_spec_limits()`: 指定された製品フォルダ内の`specs.csv`からUSL/LSLを読み込みます。
    *   `create_individual_chart()`: PlotlyのIチャートを作成します。
    *   `create_wafer_map()`: Plotlyのウェーハマップを作成します。

## 8. データファイルの管理

データは`data/`ディレクトリで管理されます。新しい製品を追加する際は、以下のルールに従ってください。

1.  **製品フォルダの作成:** `data/`ディレクトリ内に、新しい製品名のフォルダを作成します（例: `data/NewProduct/`）。
2.  **データファイルの配置:** 作成したフォルダ内に、`sort.csv`（歩留まりデータ）、`wat.csv`（WATデータ）、`specs.csv`（規格値データ）を配置します。

アプリケーションは、`data`ディレクトリのフォルダ構造を自動的に認識し、サイドバーの製品リストに反映します。

*   **`specs.csv` の形式:**
    ```csv
    parameter,USL,LSL
    Con_M0LA,1.9,1.7
    ...
    ```

## 9. 設定 (Configuration)

### 9.1. テーマ (Theme)

アプリケーションのテーマは、`.streamlit/config.toml`ファイルで設定されています。デフォルトではライトテーマに固定されています。

```toml
[theme]
base="light"
```

ダークテーマに変更したい場合は、`base`の値を`"dark"`に変更してください。