# 半導体ダッシュボード

## 1. 概要

このプロジェクトは、Streamlitで構築されたファブレス半導体企業向けのWebベースのダッシュボードです。ウェーハの歩留まりやウェーハ受け入れテスト（WAT）の統計的プロセス制御（SPC）データなど、製造データを可視化・分析するための使いやすいインターフェースを提供します。このアプリケーションは、モジュール化され、メンテナンスしやすいように設計されています。

## 2. 主な機能

*   **インタラクティブなダッシュボード**: Streamlitで構築された、シンプルでクリーンなUI。
*   **階層的なデータ分析**: 全体トレンドのサマリーから、特定のロットやウェーハへのドリルダウン分析が可能。
*   **明示的なデータ更新**: サイドバーの「Run Analysis」ボタンにより、ユーザーが明示的に指示するまでデータ処理やグラフ描画は実行されません。
*   **動的な製品選択**: `data`ディレクトリのフォルダ構成に基づき、サイドバーから製品を簡単に切り替え可能。
*   **セキュアな接続情報管理**: StreamlitのSecrets management機能 (`.streamlit/secrets.toml`) を利用してデータベース接続情報を安全に管理します。
*   **モジュール化アーキテクチャ**: UI、データ処理、チャート作成などの機能がモジュールとして整理されており、高いメンテナンス性と拡張性を持ちます。

## 3. ディレクトリ構成

```
/
├── .streamlit/          # Streamlit設定
├── data/                # ローカルテスト用CSVデータ
├── pages/               # アプリケーションページ
│   ├── 1_Yield_Dev.py   # 開発用 歩留まりページ
│   ├── 1_Yield_Prod.py  # 本番用 歩留まりページ
│   ├── 2_WAT_SPC_Dev.py # 開発用 WAT/SPCページ
│   └── 2_WAT_SPC_Prod.py# 本番用 WAT/SPCページ
├── src/                 # ソースコード
├── main.py              # アプリケーションのホームページ
├── project.md           # このプロジェクト説明ファイル
└── ...
```

(一部抜粋・簡略化)

## 5. 実行方法

以下のコマンドで、Streamlitアプリケーションを直接起動します。

```bash
streamlit run main.py
```

起動後、サイドバーに各ページの開発版（Dev）と本番版（Prod）が表示されます。目的に応じて、表示したいページを直接選択してください。

*   **`_Prod`ページ**: データベースからのデータ読み込みを前提としています。
*   **`_Dev`ページ**: データベースとローカルCSVファイルの両方からデータ読み込みを選択できます。


## 6. 使い方

1.  サイドバーで製品を選択します。
2.  実行したいデータソースに対応する「Run Analysis」ボタンをクリックします。（本番モードではボタンは1つです）
3.  各ページで分析結果を確認します。

## 7. モジュールの概要

*   **`src/modules/utils.py`**: `load_data_from_db` と `load_data_from_csv` という、データソースごとに独立したデータ読み込み関数を格納します。
*   **`src/modules/sidebar.py`**: `data`ディレクトリのフォルダ構成をスキャンし、製品選択サイドバーを動的に描画します。
*   **`src/modules/spc_charts.py`**: SPC関連のチャートを作成する汎用的な関数を格納します。
*   **`src/modules/yield_charts.py`**: 歩留まりページ (`1_Yield.py`) で使用されるチャート作成関数を格納します。
*   **`src/modules/db_utils.py`**: `.streamlit/secrets.toml` の設定に基づき、データベースへの接続を確立する `get_db_connection` 関数などを提供します。

## 8. データソースの管理

### 8.1. 開発モード (CSV)

開発モードでは、「Run Analysis (CSV)」ボタンを使用することで、`data/`ディレクトリ内のCSVファイルをデータソースとして利用できます。

### 8.2. 本番モード (Oracle DB)

本番モードでは、アプリケーションは `.streamlit/secrets.toml` ファイルに定義された情報を使ってOracleデータベースに接続します。このファイルが存在しない、または情報が不完全な場合はエラーが表示されます。

```toml
# .streamlit/secrets.toml

[database]
username = "your_actual_username"
password = "your_actual_password"
dsn = "your_oracle_host:1521/your_service_name"
```

**重要:** この `secrets.toml` ファイルは `.gitignore` によってバージョン管理から除外されています。絶対にリポジトリにコミットしないでください。

## 9. 設定 (Configuration)

### 9.1. 動作モードの切り替え

アプリケーションの動作モードは、環境変数 `APP_MODE` で制御します。

*   **`production`**: 本番モード。データベース接続が必須となり、CSV関連のUIは非表示になります。
*   **`development`** (または未設定): 開発モード。DBとCSVの両方のオプションが利用可能です。

### 9.2. テーマ (Theme)

アプリケーションのテーマは、`.streamlit/config.toml`ファイルでライトテーマに固定されています。

## 10. 今後のロードマップ (Future Roadmap)

（変更なし）
